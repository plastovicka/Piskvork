<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
<meta name="description" content="novy protokol pro komunikaci piskvorkovych brainu">
<meta name="author" content="Martin Petricek">
<meta name="language" content="Czech">
<title>Novı protokol</title>
<link rel="stylesheet" type="text/css" href="../styl.css">
</head>

<body>
<h1>Novı protokol</h1>

<p align="center">
  <a href="info.htm"><span class="bigbutton">Zpìt na informace</span></a>
  <br>
</p>

<h2>Úvod</h2>
<p>
Pøíkazy putují do roury vdy jeden pøíkaz na øádce, po pøíkazu je poslána
sekvence CRLF (0x0d, 0x0a) - neboli konec øádky.<br>
Manaer oèekává odpoveïi takté ukonèené CRLF, nebo jenom LF nebo jenom CR.
Prázdné øádky ignoruje.<br>
V zásadì lze pøíkazy èíst treba obyèejnım readln,scanf, nebo nìèím podobnım a odpovídat pomocí
writeln, printf, nebo nìèím podobnım a bude to fungovat bez problému.<br>
Brainu staèí aby umìl pøíkazy BEGIN, END, TURN a START, umìl korektnì buï zpracovávat,
nebo ignorovat INFO a na zbylé pøíkazy mùe klidnì odpovídat "UNKNOWN". Pokud se protokol
rozšíøí o nìjaké další pøíkazy (napø. analıza tahu), tak nebudou dùleité pro pouití v turnaji<br>
<br>
Jinak je pomìrnì dùleité aby brain neèetl ze vstupu kdy nemá (nebo neèeká na další pøíkaz)
a nezapisoval tam kdy nemá, pokud se pokusí èíst další pøíkaz ve chvíli kdy se od nìj oèekává
odpovìï, tak dojde k zablokování (brain èeká a na další pøíkaz, manager èeká na odpovìï -
vzniká deadlock) a typicky to po timeoutu na tah pak skonèí odstøelením a diskvalifikaci brainu.
<br>
Název brainu musí zaèínat na "pbrain-"<br>
<br>
Pøíklad:<br>
<code>
pbrain-svine.exe<br>
pbrain-pisq5.exe<br>
</code>
pokud brain zaèíná na jinı prefix, tak se bere e komunikuje <a href="protocl1.htm" title="popis starého protokolu">starou metodou pøes soubor</a>
</p>

<h3>Reakce na neznámı pøíkaz</h3>

<p>
<b>Jak by se mìl brain chovat kdy dostane jinı pøíkaz, kterému nerozumí?</b><br>

  Mìl by vrátit øádku zaèínající øetìzcem "UNKNOWN" následovanım volitelnì
  nìjakım human-readable popisem chyby. Manager se pak zkusí buï obejít
  bez podpory toho pøíkazu, nebo shledá-li to fatální, pošle pøíkaz END.
  Obdrení neznámého pøíkazu tedy není dùvodem k ukonèení brainu.
</p>

<h3>Reakce na špatnı pøíkaz</h3>
<p>

<b>Jak by se mìl brain chovat kdy dostane pøíkaz, kterému rozumí, ale nemùe ho
 z jakéhokoliv dùvodu provést (napø. pøedtím dostal nevyhovující info hodnotu)</b><br>

 Mìl by vrátit øádku zaèínající øetìzcem "ERROR" následovanım volitelnì
 nìjakım human-readable popisem chyby. Manager pak buï zkusí pøíkaz
 provést jinak, nebo pošle pokyn ke konci (pøíkaz END).
</p>

<h2>Pøíkazy</h2>

<h3>INFO [klíè] [hodnota]</h3>
<pre>
 Manaer posílá brainu informaci (jakı je nastaven èasovı limit, atd ....)
 klíè je jeden z:

 timeout_match - hodnota udává limit na zápas v milisekundách (0=bez limitu)
 timeout_turn  - hodnota udává limit na tah v milisekundách (0=bez limitu)
 max_memory    - hodnota udává limit na maximální spotøebovanou pamì (v bajtech, 0=bez limitu).

 Pøíklad:
 INFO timeout_match 300000
 INFO timeout_turn 10000
 INFO max_memory 83886080

Jak by se mìl brain chovat kdy dostane INFO, kterému nerozumí:
- Ignorovat ho, není to nic dùleitého. Pokud by to bylo dùleité,
  dostal by pøíkaz, ktreremu nerozumí

Jak by se mìl brain chovat kdy dostane INFO, kterému rozumí, ale je nepøijatelné
 (napø. pøíliš malı limit na pamì)
- Brain musí s vracením chyby poèkat a dostane první pøíkaz (typicky do MOVE nebo BEGIN),
  nebo info pøíkazy nejsou nikdy posílanı samostatnì, vdy pøedchází nìjakému jinému pøíkazu
  a bìhem posílání info pøíkazu manager neète vstup (take snaha tam nìco poslat vede k
  zablokování procesu).

 Oèekávaná odpovìï: ádná
</pre>

<h3>START [velikost]</h3>
<pre>
 Instrukce pro brain k inicializaci dat. Parametrem je celé èíslo urèující velikost plochy
 V tomto turnaji bude velikost vdy 20, nicménì v protokolu je takhle rezerva do budoucna,
 pokud budeme chtít velikost ploch zmìnit. Tímto se pouze inicializuje brain, ještì ale
 nemá provést ádnı tah.

 Pøíklad:
 START 20

 Oèekávaná odpovìï:
 "OK" - parametry vyhovují
 cokoliv jiného: øetìzec bude brán jako chybová hláška a bude zobrazen v manaeru (napø. e
 neumí jiné rozmìry ne 20x20, eventuelnì mu nevyhovují pamìové limity, atd ...)
</pre>

<h3>TURN [X],[Y]</h3>

<pre>
øíká brainovi na které souøadnice tahnul soupeø. Souøadnice jsou èíslovány od nuly.

 Oèekávaná odpovìï:
 dvì èísla oddìlená èárkou - kam tahne brain

 Pøíklad:
 TURN 10,10
 odpovìï:
 11,10
</pre>

<h3>BEGIN</h3>

<pre>
 jednomu z brainu bude tento pøíkaz poslán po startu
 - neboli e brain má zaèít na této prázdné ploše hrát.
 Druhı z brainu dostane po startu místo toho pøíkaz TURN s prvním tah soupeøe

 Oèekávaná odpovìï:
 dvì èísla oddìlená èárkou - kam táhne brain

 Pøíklad:
 BEGIN
 odpovìï:
 10,10
</pre>

<h3>END</h3>
<pre>
 Pøíkaz k ukonèení brainu. Brain by se mìl co nejrychleji ukonèit (pokud to neudìlá,
 bude odstrelen). Tenhle pøíkaz se pošle oboum brainùm po dohrání hry.

 Oèekávaná odpovìï:
 Oèekává se, e se brain co nejrychleji ukonèí a nebude posílat ádnou odpovìï.
 Pøed ukonèením by mìl po sobì smazat všechny doèasné soubory, pokud si nìkde nìjaké vytvoøil.
</pre>

<p>
Timelimit na partii se bude poèítat od spuštìní procesu do zaslání pøíkazu END
(ukonèování se tedy u nepoèítá, i kdy pokud bude trvat déle ne chvilku, bude
proces odstøelen).<br>
Timelimit na tah se buï poèítat od poslání pøíkazu BEGIN resp. TURN do obdrení odpovìdi.<br>
Po odehrání svého tahu by se mìl brain zablokovat tím, e bude èekat na další pøíkaz
(další tah) - ale pro jistotu pøi tahu jednoho procesu toho druhého vdy radši manaer zastaví.<br>
(Brain by nemìl pøemıšlet bìhem tahu soupeøe a tak mu uírat CPU)<br>
</p>

<h2>ROZŠÍØENÍ PROTOKOLU</h2>

<p>
Rozšíøení zde uvedené nemusí bıt implementované pro úèast v turnaji, nicménì
autor se mùe rozhodnout je implementovat, nebo mu mohou bıt uiteèné.
</p>

<h3>Oznamování zbıvajícího èasu</h3>
<pre>
Pøed kadım tahem (pøíkaz TURN nebo BEGIN) bude poslána hodnota
info TIME_LEFT v milisekundách, která øíká kolik brainu zbıvá èasu
(aby si to nemusel hlídat sám)

pøíklad:

INFO time_left 278123
TURN 10,14
</pre>

<h3>Hlášky od brainu</h3>

<pre>
Pokud brain pošle místo oèekávané odpovìdi na pøíkaz øádku zaèínající na "MESSAGE"
  (informace) nebo "DEBUG" (debugovací informace), tak se tato øádka pøeskoèí a pøeète
  se další (take takovychhle øádek tam mùe bıt za sebou i více). Manager tyhle informace
  buï bude ignorovat, nebo tam pùjde zapnout monost si je logovat do souboru nebo do
  nìjakého okna.

Pøíklad:
manager pošle:

TURN 10,15

brain odpoví:

DEBUG Zatím nejlepší tah [10,14] alfa=10025 beta=8641
DEBUG Zatím nejlepší tah [11,14] alfa=10125 beta=8641
MESSAGE Mám to vyhranı
10,16
</pre>

<h3>SUGGEST</h3>

<pre>
Tohle je rozšíøení protokolu, které se nebude pouívat na turnaji, brainy ho tedy
 nemusí podporovat, ale mùe se hodit pro debugovani a porovnávání brainù.
Pokud brain místo tahu (napø "10 9") odpoví:
SUGGEST [X],[Y]
kde [X] a [Y] jsou souøadnice kam chce táhnout, dává tím manaeru najevo, e toto
 rozšíøení podporuje a chce pouívat. Tímto má manager monost na druhé stranì tah,
 kterı tento algoritmus vymyslel zmìnit a vnutit mu jinı, kterı pak on ve svém
 vnitøním stavu provede. Brain tedy po odeslání SUGGEST nemìní svùj vnitøní stav,
 manager na toto odpoví vdy buï pøíkazem PLAY, kterım mu vnutí tah, nebo END.
</pre>

<h3>PLAY [X],[Y]</h3>
<pre>
 Vnucení tahu brainu - øíká brainu, e svùj další tah má udìlat na políèko
 dané souøadnicemi [X],[Y].
 Pouívá se pouze jako odpovìï na SUGGEST.

 Oèekávaná odpovìï:
 Stejnì jako na pøíkaz TURN nebo BEGIN - dvì èísla oddìlená èárkou, neboli
 kam brain tahnul. Brain se mùe rozhodnout tohle vnucení tahu ignorovat a táhnout jinam,
 pro manager je relevantní co brain vrátí, ale silnì se nedoporuèuje tento pøíkaz
 neposlechnout.

 Pøíklad, brain odpovìdìl:
  SUGGEST 10,10
 odpovìï managera:
  PLAY 12,10
 Brain udìlá tah na 12,10 a odpoví:
  12,10

 V turnaji manaer brainu vdy vrátí tah, kterı brain poslal v SUGGEST. 
</pre>

<h3>BOARD</h3>
<pre>
[data]
 Tímto lze vnutit brainu úplnì novou plochu. Vhodné pro pokraèování napø. nìjaké
 rozehrané partie.
 Je posláno místo pøíkazu BEGIN nebo TURN po inicializaci (pøíkaz START).
 Tento pøíkaz nebude poslán brainovi, ve kterém je rozehrána nìjaká hra - v takovém
 pøípadì by byl brain odstrelen a spuštìn novı.

 Po tomto pøíkazu jsou poslány data tvoøící plochu, je to vdy jeden záznam na jeden øádek ve formátu:
 [X],[Y],[POLE]
 kde [X] a [Y] jsou souøadnice a [POLE] je buï èíslo 1 (vlastní piškvorka) nebo 2 (piškvorka soupeøe)
 Tyto tahy jsou poslány v poøadí v jakém byly provedeny, pokud je tato informace o tazích
 k dispozici, pokud ne, mohou bıt poslány políèka v libovolném poøadí.
 data jsou ukonèeny samostatnım øádkem DONE.

 Tímto pøíkazem se od brainu oèekává e bude z této pozice ihned táhnout, neboli èeká se
 odpovìï jako u pøíkazu TURN nebo BEGIN

Pøíklad:

 Manager pošle:
  BOARD
  10,10,1
  10,11,2
  11,11,1
  9,10,2
  DONE
 Brain odpoví:
  9,9
</pre>

<h3>ABOUT</h3>
<pre>
 Od brainu se èeká, e pošle na jedné øádce o sobì nìjaké struèné info
 (urèené pro zobrazení èlovìkovi)
 Je celkem jedno co vrátí, ale mìl by o sobì sdìlit nejlépe jméno, verzi a autora
 Brain smí jako odpovìï poslat pouze jednu øádku textu

 Manager pošle:
  ABOUT
 Brain odpoví:
  SomeBrain version 1.0, author Nymand
</pre>


</body>

</html>